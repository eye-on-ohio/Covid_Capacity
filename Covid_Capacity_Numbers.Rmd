---
title: "Covid_Capacity"
author: "Lucia Walinchus"
date: "11/18/2020"
output: html_document
---

```{r setup, include=FALSE}
library(dplyr)
library(ggplot2)
library(lubridate)
library(readxl)
library(DT)
#library(ggmap)
library(stringr)


```

## Looking at Ohio Hospital Capacity

So needless to say we have been requesting this information for a while now. 
See: [After seven month legal battle, Eye on Ohio wins public records lawsuit over hospital capacity numbers](https://eyeonohio.com/after-seven-month-legal-battle-eye-on-ohio-wins-public-records-lawsuit-over-hospital-capacity-numbers/)

Basically, both the Governor and the Court have said the People of the State of Ohio should get these records. They gave us some numbers from Surgenet but they seem woefully incomplete. Let's take a look. 

First, we know that these numbers have been released before. 

For example, here is info we got [from HHS in September.](https://eyeonohio.com/wp-content/uploads/2020/11/CASPER-072420207063.pdf) And there are dozens of facilities [listed on the Surgenet website itself.](https://ohio.surgenet.org/Registration.aspx) And obviously if you go on Ohio's [Coronavirus website](https://coronavirus.ohio.gov/wps/portal/gov/covid-19/dashboards/key-metrics/hospitalizations), you can see the numbers statewide. 

We just want daily updated ones. 


Loading the files from the Ohio Department of Health:

```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet Files")

list_of_absentee_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)

incomplete_files <- list_of_absentee_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```


11-23 update: we now have more files from ODH. 

```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 11.16-11.20/")

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)

second_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Okay we are up to 11/20. Not great as we are writing this on 11/23. But better than the end of October. We'll add these two together. 


```{r}
incomplete_files <- rbind(incomplete_files, second_wave_of_files)
```

11-24 update: We have those first few weeks in November now from ODH. 

```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 10.31-11.15/")

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)

third_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files, third_wave_of_files)
```

11/26 update: Today ODH sent us capacity from 11/21 through 11/24. So adding that. 


```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 11.21.20 - 11.24.20/")

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)

fourth_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files, fourth_wave_of_files)
```

12/7 update: we now have more files from ODH. 

```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 11.25.20-12.4.20")

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)

fifth_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files, fifth_wave_of_files)
```

12/14 update: Got more files from ODH

```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 12.5.20-12.11.20/")

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)

sixth_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files, sixth_wave_of_files)
```

12/21 update: Got more files from ODH

```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 12.12.20-12.18.20/")

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)

seventh_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files, seventh_wave_of_files)
```

12/29  update: got more files from ODH
```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 12.19.20-12.23.20/")

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)

eighth_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files, eighth_wave_of_files)
```
1/4/2020 update: got more files from ODH
```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 12.24.20-12.30.20/")

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)

ninth_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files, ninth_wave_of_files)
```

1/11/2020 update: got more files from ODH
```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 12.31.20-1.8.2021/")

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)

tenth_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,tenth_wave_of_files)
```

1/19/2020 update: got more files from ODH
```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 1.9.21-1-15-21/")

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)

eleventh_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,eleventh_wave_of_files)
```


1/25/2020 update: got more files from ODH
```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 1.16.21-1.22.21/")

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)

twelveth_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,twelveth_wave_of_files)
```


2/1 update:  update: got more files from ODH
```{r}
setwd("~/Code/Covid_Capacity/1.23.2021 -1.29-2021/")

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)

thirteenth_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,thirteenth_wave_of_files)
```

2/8 update:  update: got more files from ODH
```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 1.30.2021-2.5.2021/")

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)

fourteenth_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,fourteenth_wave_of_files)
```


2/17 update:  update: got more files from ODH.

For some reason, this batch contains a Saline column, though there's not a whole lot reporting it. 
```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 2.6.2021 - 2.12.2021/")

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)


fifteenth_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}

fifteenth_wave_of_files <- fifteenth_wave_of_files %>% 
  select(-Saline)

incomplete_files <- rbind(incomplete_files,fifteenth_wave_of_files)
```
2-22 update: got more files from ODH.


```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 12.13.2021-12.19.2021/") #This a typo it's actually 2-13

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)


sixteenth_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,sixteenth_wave_of_files)
```
3/1 update: 

```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 2.20.2021-2.26.2021/") #This a typo it's actually 2-13

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)


seventeenth_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,seventeenth_wave_of_files)
```
3/5 update: 

```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 2.27.21-3.5.21/") #This a typo it's actually 2-13

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)


eighteenth_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,eighteenth_wave_of_files)
```
3/15 Update:
```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 3.6.21-3.12.21/") 

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)


ninteenth_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,ninteenth_wave_of_files)
```

3/22 Update:
```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 3.13.21-3.19.21/") 

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)


twentieth_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,twentieth_wave_of_files)
```

3/29 Update:
```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 3.20.21-3.26.21/") 

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)


twentyfirst_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,twentyfirst_wave_of_files)
```

4/5 update:


```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 3.27.2021-4.2.2021/") 

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)


twentysecond_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,twentysecond_wave_of_files)
```


```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 4.3.2021-4.9.2021 2/") 

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)


twentythird_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,twentythird_wave_of_files)
```


ODH SurgeNet 4.10.21-4.16.21

```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 4.10.21-4.16.21/") 

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)


twentyfourth_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,twentyfourth_wave_of_files)
```



```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 4.17.21-4.23.21/") 

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)


twentyfifth_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,twentyfifth_wave_of_files)
```


```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 4.24.21-4.30.21/") 

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)


twentysixth_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,twentysixth_wave_of_files)
```



```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 5.1.21-5.7.21/") 

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)


twentyseventh_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,twentyseventh_wave_of_files)
```

May 17 update: more files from ODH

```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 5.8-5.14.21/") 

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)


twentyeighth_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,twentyeighth_wave_of_files)
```



May 24 update: 
```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 5.15.21-5.21.21/") 

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)


twentyninth_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,twentyninth_wave_of_files)
```

June 1 update: 
```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 5.22.21-5.28.21/") 

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)


thirtieth_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,thirtieth_wave_of_files)
```

June 8 update: 
ODH SurgeNet 5.29.21-6.4.21
```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 5.29.21-6.4.21/") 

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)


thirtyfirst_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,thirtyfirst_wave_of_files)
```


```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 6.5.21-6.11.21/") 

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)


thirtysecond_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,thirtysecond_wave_of_files)
```

```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 6.12.21- 6.18.21/") 

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)


thirtythird_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,thirtythird_wave_of_files)
```

```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 6.19.21 -6.25.21/") 

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)


thirtyfourth_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,thirtyfourth_wave_of_files)
```

```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 6.26.21-7.2.21/") 

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)


thirtyfifth_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,thirtyfifth_wave_of_files)
```

```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 7.3-7.9/") 

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)


thirtysixth_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,thirtysixth_wave_of_files)
```

```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 7.10.21-7.16.21/") 

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)


thirtyseventh_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,thirtyseventh_wave_of_files)
```

```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 7.17.21-7.23.21/") 

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)


thirtyeighth_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,thirtyeighth_wave_of_files)
```

```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 7.24.21-7.30.21/") 

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)


thirtyninth_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,thirtyninth_wave_of_files)
```


```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 7.31.21-8.6.21/") 

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)


fortieth_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,fortieth_wave_of_files)
```

```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 8.7.21-8.13.21/") 

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)


fortyfirst_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,fortyfirst_wave_of_files)
```

```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 8.14.21 - 8.20.21/") 

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)


fortysecond_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```


```{r}
incomplete_files <- rbind(incomplete_files,fortysecond_wave_of_files)
```


Aug 30 update: 
```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 8.21.21-8.27.21/")

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)


fortythird_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,fortythird_wave_of_files)
```

Sept 7 update:
```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 8.28.21-9.3.21/")

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)


fortyfourth_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,fortyfourth_wave_of_files)
```


Sept 13 update:
```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 9.4.21-9.10.21/")

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)


fortyfifth_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,fortyfifth_wave_of_files)
```

Sept 20 update:
```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 9.11.21-9.17.21/")

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)


fortysixth_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,fortysixth_wave_of_files)
```

Sept 27 update: 
```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 9.18.21-9.24.21/")

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)


fortyseventh_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,fortyseventh_wave_of_files)
```

Oct 4 update: 
```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 9.25.2021-10.1.2021/")

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)


fortyeighth_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,fortyeighth_wave_of_files)
```



Oct 11 update: 
```{r}
setwd("~/Code/Covid_Capacity/ODH SurgeNet 10.2.2021-10.8.2021/")

list_of_files_xlsx <- list.files(path = ".", recursive = TRUE,
                            pattern = "\\.xlsx$", 
                            full.names = TRUE)


fortyninth_wave_of_files <- list_of_files_xlsx %>%
  purrr::set_names(nm = (basename(.) %>% tools::file_path_sans_ext())) %>%
  purrr::map_df(read_excel, 
                .id = "FileName")

```

Adding that again: 

```{r}
incomplete_files <- rbind(incomplete_files,fortyninth_wave_of_files)
```



Getting rid of obvious outliers

```{r}
#incomplete_files$`Critical Care` <- as.double(incomplete_files$`Critical Care`)
#incomplete_files$`Med/Surg` <- as.double(incomplete_files$`Med/Surg`)

#incomplete_files <- incomplete_files %>% 
  #filter(`Critical Care`!=990 & `Critical Care`!=900 &
          #`Critical Care`!=712 &
           #`Critical Care`!=313 &
           #`Critical Care`!=231 &
           #`Critical Care`!=215 &
           #`Critical Care`!=198 )
  
```


another bizarre occurence: Before Aug 25, 2021 West Chester hospital has one name. Then the suffix changes. So fixing that. 

```{r}
#"West Chester" %in%  incomplete_files$Facility
#"West Chester Hospital (T3)"  
#"West Chester Hospital (T3-P)" 
```








How many hospitals are there total?

```{r pressure, echo=FALSE}
hospitals <- unique(incomplete_files$Facility)
sort(hospitals, decreasing = FALSE)
```

Hmm. The American [Hospital Directory](https://www.ahd.com/states/hospital_OH.html) only lists 146 so that's good. But all the info is not there every day. 


Also hospitals with a slash in there will give us issues.

So we will change it so we can save it later. 

```{r}
incomplete_files$Facility <- 
  str_replace(incomplete_files$Facility, "/","-")
```



How often did hospitals report per day for adult beds?

```{r}
Hospitals_per_day_adult <- incomplete_files %>% 
  filter(FileName=="Hospital- Adult Bed Availability") %>% 
  group_by(yday(Date), Facility) %>% 
  summarize(Total=n())
  
datatable(Hospitals_per_day_adult)
```


Okay so big variation here. Some report up to 42 times a day. Some report once. 

How many hospitals checked in per day?

```{r}
Hospitals_per_day_adult %>% 
  group_by(`yday(Date)`) %>% 
  summarize(Total=n())
```


```{r}
ggplot(Hospitals_per_day_adult, aes(x=`yday(Date)`))+
         geom_bar()+
        xlab("Day of the Year")
```
So it looks like only a few checked in, in March, then most check in, or it hovers around the 190 level or so later. 

And keep in mind this is only adult hospitals. Though we have pediatric data, too. We didn't include that because most adult hospitals report 0 for pediatric beds and vice versa. 

So here, we're going to take out the data before March 16. It seems that before then, our date is incomplete. And we'll get rid of NAs as they were just blanks on the spreadsheet.

```{r}
incomplete_files <- incomplete_files %>% 
  filter(Date>"2020-3-16") %>%  #This filters from after midnight on 3/15 %>% 
filter(!is.na(Facility))
```



Let's look at total capacity over time. Getting just the hospital beds:

```{r}
Hospital_Beds <- incomplete_files %>% 
  filter(FileName=="Hospital- Adult Bed Availability"|
           FileName=="Hospital- Pediatric Bed Availability"|
           FileName=="ODH Adult Hospital Bed Availability"|
           FileName=="ODH Peds Hospital Bed Availability")
```

Which hospitals had few beds left as of the last day?

```{r}
Adult_Beds_On_Last_Day <- Hospital_Beds %>%
  filter(Date>"2020-11-24")

#No `Pediatric Airborne Infection Isolation`. Why?
```

This is interesting. On Oct 30, 33 hospitals reported zero beds available for adults either in the “Med/Surg” or “Critical Care” categories at some point during the day. But not very useful as that was several weeks ago. 

Okay so from a data standpoint this is tricky. Some hospitals check in several times per day as their numbers change. We want to add a number per day but we don't want to overestimate. So like, if a hospital says it has 10 in the morning and 20 in the afternoon, if we want to add the total number in all hospitals per day we don't want to add 30 for that hospital where the number hovered between 10 and 20. 

Also, because of shortages, some pediatric hospitals are taking on adults. Do they overlap?

```{r}
Adult_hospitals <- Hospital_Beds %>% 
  filter(FileName=="Hospital- Adult Bed Availability")


Adult_hospitals <- unique(Adult_hospitals$Facility)
Adult_hospitals
```


```{r}
Kid_hospitals <- Hospital_Beds %>% 
  filter(FileName=="Hospital- Pediatric Bed Availability")


Kid_hospitals <- unique(Kid_hospitals$Facility)
Kid_hospitals
```


Okay so a lot of overlap here. Some adult hospitals have kid spots open and vice versa.

Let's look at just one to see how they report them: 

```{r}
Springfield <- Hospital_Beds %>% filter(Facility=="Springfield Regional Medical Center")
Springfield
```

This just reports adult beds. Let's try a facility we know mainly for children:

```{r}
Dayton_Childrens<- Hospital_Beds %>% filter(Facility=="Dayton Children's (T1-P)")
Dayton_Childrens
```

They report zero for adults and more for pediatrics, essentially.

First we look at capacity across the state:

```{r}
Hospital_Beds_By_Day_and_Facility <- Hospital_Beds %>% 
  mutate(Day=day(Date),Month=month(Date)) %>% 
  mutate(`Med/Surg`=as.double(`Med/Surg`), 
         `Critical Care`=as.double(`Critical Care`), 
         `Airborne Inf Isolation`=as.double(`Airborne Inf Isolation`), 
         `Pediatric Airborne Infection Isolation`=as.double(`Pediatric Airborne Infection Isolation`)) %>% 
  select(-...1,-Ventilators,-N95,-Gloves,-`Face Protection`,-`Impermeable Gowns`) %>% 
  filter(!Date==is.na(Date))
         
Hospital_Beds_By_Day_and_Facility[is.na(Hospital_Beds_By_Day_and_Facility)] <- 0      

Adult_Hospital_Beds_By_Day_and_Facility   <-  Hospital_Beds_By_Day_and_Facility %>% 
  filter(FileName=='Hospital- Adult Bed Availability'| FileName=="ODH Adult Hospital Bed Availability")

Kid_Hospital_Beds_By_Day_and_Facility   <-  Hospital_Beds_By_Day_and_Facility %>% 
  filter(FileName=='Hospital- Pediatric Bed Availability'|FileName=="ODH Peds Hospital Bed Availability")

Adult_Beds_Over_Time <- Adult_Hospital_Beds_By_Day_and_Facility %>%          
  group_by(Month, Day, Facility) %>% 
  summarize(`Average_Med/Surg`=mean(`Med/Surg`), 
            Average_Critical_Care=mean(`Critical Care`),
            Average_Airborne_Infectious_Isolation=mean(`Airborne Inf Isolation`)) %>% 
  mutate(Date=paste0(Month,"/",Day,"/2020"))


Kid_Beds_Over_Time <- Kid_Hospital_Beds_By_Day_and_Facility %>%          
  group_by(Month, Day, Facility) %>% 
  summarize(`Average_Med/Surg`=mean(`Med/Surg`), 
            Average_Critical_Care=mean(`Critical Care`),
            Average_Airborne_Infectious_Isolation=mean(`Pediatric Airborne Infection Isolation`))%>% 
  mutate(Date=paste0(Month,"/",Day,"/2020"))


rio::export(Adult_Beds_Over_Time, "Adult Beds over time.csv")

rio::export(Kid_Beds_Over_Time, "Kid Beds over time.csv")

```

We will vizualize this in Tableau. 

Here, we want to compare it to covid Data: 

```{r}
Cases <- rio::import("https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-states.csv")

```

This is all over Ohio, which was released a while ago, so it's not that exciting. Essentially, assuming a linear trajectory, we run out of hospital beds around mid-March without further intervention. 

But a hospital bed in a big city doesn't really help you if you don't live near that city. Let's get to the local data. 


Adult med/surg beds:
```{r}
setwd("~/Code/Covid_Capacity/Adult_Med_Surg")
Adult_Capacity <- function(Yo.Hospital){Adult_Hospital_Beds_By_Day_and_Facility %>% 
    filter(Facility==Yo.Hospital) %>%
    ggplot(aes(x=Date, y=`Med/Surg`))+
    geom_line()+
    labs(title=paste(Yo.Hospital,"-Adult Med/Surg beds available"),subtitle=("Mid-March 2020 through Oct. 8, 2021"),caption = "Source: Ohio Department of Health; Graph credit: Eye on Ohio, the Ohio Center for Journalism")
  ggsave(paste0(Yo.Hospital,".jpeg"), plot = last_plot(), device="jpeg")
}

#Adult_Capacity("Cleveland Clinic Avon Hospital")


purrr::map(Adult_hospitals, Adult_Capacity)
```


ICU beds for adults:
```{r}
setwd("~/Code/Covid_Capacity/Adult_ICU")
Adult_ICU_Capacity <- function(Yo.Hospital){Adult_Hospital_Beds_By_Day_and_Facility %>% 
    filter(Facility==Yo.Hospital) %>%
    ggplot(aes(x=Date, y=`Critical Care`))+
    geom_line()+
    labs(title=paste(Yo.Hospital,"-Adult Critical Care beds available"),subtitle=("Mid-March 2020 through Oct. 8, 2021"),caption = "Source: Ohio Department of Health; Graph credit: Eye on Ohio, the Ohio Center for Journalism")
  ggsave(Yo.Hospital, plot = last_plot(), device="jpeg")
}

#Adult_ICU_Capacity("Cleveland Clinic Avon Hospital")


purrr::map(Adult_hospitals, Adult_ICU_Capacity)


```

Pediatric Med/Surge Beds: 

```{r}
setwd("~/Code/Covid_Capacity/Kid_Med_Surg")
Kid_Capacity <- function(Yo.Hospital){Kid_Hospital_Beds_By_Day_and_Facility %>% 
    filter(Facility==Yo.Hospital) %>%
    ggplot(aes(x=Date, y=`Med/Surg`))+
    geom_line()+
    labs(title=paste(Yo.Hospital,"-Pediatric Med/Surg beds available"),subtitle=("Mid-March 2020 through Oct. 8, 2021"),caption = "Source: Ohio Department of Health; Graph credit: Eye on Ohio, the Ohio Center for Journalism")
  ggsave(Yo.Hospital, plot = last_plot(), device="jpeg")
}

#Kid_Capacity("Cleveland Clinic Avon Hospital")


purrr::map(Kid_hospitals, Kid_Capacity)


```

Pediatric ICUs:

```{r}
setwd("~/Code/Covid_Capacity/Kid_ICU")
Kid_ICU_Capacity <- function(Yo.Hospital){Kid_Hospital_Beds_By_Day_and_Facility %>% 
    filter(Facility==Yo.Hospital) %>%
    ggplot(aes(x=Date, y=`Critical Care`))+
    geom_line()+
    labs(title=paste(Yo.Hospital,"-Pediatric Critical Care beds available"),subtitle=("Mid-March 2020 through Oct. 8, 2021"),caption = "Source: Ohio Department of Health; Graph credit: Eye on Ohio, the Ohio Center for Journalism")
  ggsave(Yo.Hospital, plot = last_plot(), device="jpeg")
}

#Kid_Capacity("Cleveland Clinic Avon Hospital")


purrr::map(Kid_hospitals, Kid_ICU_Capacity)


```

##Location

Now we're going to add location data. For this *you will need your own key.* 

```{r}
hospitals <- tibble(hospitals) %>% 
  filter(!is.na(hospitals))
#hospitals_geocoded <- geocode(hospitals$hospitals) #this costs money so you don't want to run it every time.
#hospitals_geocoded <- cbind(hospitals, hospitals_geocoded)
```


Looks like some hospitals did not geocode right. (Which isn't surprising as we only had their names.)
*Community Memorial 41.30209704837229, -84.75594180963344
*Select Specialty 40.0641049403777, -82.96341456168929
*Margaret Mary - IN 39.33167533432329, -85.21523083649826
*St. Luke's   41.58195943558429, -83.66650688930193
*Grandview Medical Center T3 39.769933336203444, -84.20258841315876
*Memorial Health   39.41438447650042, -81.43873135420797
*Good Samaritan Hospital  39.1197550562743, -84.49276812102077
*Kindred Hospital 39.78052085071015, -84.20247357275554
*Jewish Hospital  39.206063516361944, -84.38103127190986
*Fort Hamilton(T3) 39.41568004173283, -84.57239396714651
*Acuity Speciality 40.402357134935684, -80.52635339677575

```{r}
Better_Geocodes <-  tribble(
  ~`hospitals`, ~`lat`, ~`lon`,
  "Community Memorial Hospital", 41.30209704837229, -84.75594180963344,
"Select Specialty Hospital", 40.0641049403777, -82.96341456168929,
"Margaret Mary - IN", 39.33167533432329, -85.21523083649826,
"St Luke's Hospital",  41.58195943558429, -83.66650688930193,
"Grandview Medical Center (T3)", 39.769933336203444, -84.20258841315876,
"Memorial Health (P)",  39.41438447650042, -81.43873135420797,
"Good Samaritan Hospital",  39.1197550562743, -84.49276812102077,
"Kindred Hospital",  39.78052085071015, -84.20247357275554,
"Jewish Hospital",  39.206063516361944, -84.38103127190986,
"Fort Hamilton (T3)", 39.41568004173283, -84.57239396714651,
"Acuity Specialty Hospital", 40.402357134935684, -80.52635339677575,
"Shriners - Children Burn",39.13816150796455, -84.50094077967547,
"Sycamore Medical Center", 39.637707323812215, -84.2485410015102,
"Mercy Medical Center (T2)", 40.812221676118455, -81.39604852449766,
"Fayette County",39.548229186910994, -83.42699309370892

)
```




```{r}
hospitals_geocoded <- hospitals_geocoded %>% 
filter(!hospitals=="Community Memorial Hospital")%>%
filter(!hospitals=="Select Specialty Hospital")%>%
filter(!hospitals=="Margaret Mary - IN")%>%
filter(!hospitals=="St Luke's Hospital")  %>%
filter(!hospitals=="Grandview Medical Center (T3)")%>%
filter(!hospitals=="Memorial Health (P)")  %>%
filter(!hospitals=="Good Samaritan Hospital") %>%
filter(!hospitals=="Kindred Hospital")  %>%
filter(!hospitals=="Jewish Hospital") %>%
filter(!hospitals=="Fort Hamilton (T3)")%>%
filter(!hospitals=="Acuity Specialty Hospital") %>% 
filter(!hospitals=="Shriners - Children Burn") %>% 
filter(!hospitals=="Sycamore Medical Center") %>% 
filter(!hospitals=="Mercy Medical Center (T2)") %>% 
filter(!hospitals=="Fayette County") 

```

Adding them together



```{r}
Better_Geocodes <- relocate(Better_Geocodes, lat, .after = last_col())

hospitals_geocoded<- rbind(hospitals_geocoded, Better_Geocodes)



data <- incomplete_files %>% 
  select(-`...1`) %>% 
  filter(!is.na(Facility)) 



data <- left_join(data,hospitals_geocoded, by = c("Facility"="hospitals"))

data <- distinct(data) #Gets rid of duplicates


```



Looking at HHS data: 

```{r}
#HHS_Data <- rio::import("reported_hospital_capacity_admissions_facility-level_weekly_average_timeseries_20201207.csv")
```

Which hospitals were the worst in the past week?
```{r}
worst_hospitals <- function(Yo.hospital) {data %>% 
  filter(Facility==Yo.hospital) %>% 
  mutate(Max_Beds = if_else(Date==max(Date),`Med/Surg`,"skip")) %>% 
    filter(`Med/Surg`=="skip")
  
}
```


```{r}
#Hospitals_With_Least_capacity <- purrr::map(hospitals, worst_hospitals)
```


```{r}
last_date <- data %>% 
  group_by(Facility) %>% 
  summarize(Max_Date=max(Date),
            Seven_Days_before=(max(Date)-7)) %>% 
  ungroup()
```


Which have been the most full in the past week?

#Med/Surge
```{r}
full_Med_Surge <- data %>% filter(`Med/Surg`==0) %>% filter(Date>(today()-7)) %>% count(Facility)

datatable(full_Med_Surge)

```

Which have been the most full in the past week?

#ICU
```{r}
full_ICU <- data %>% filter(`Critical Care`==0) %>% filter(Date>(today()-7)) %>% count(Facility)

datatable(full_ICU)

```


Number of reports in last week: 
```{r}
last_week <- data %>%  filter(!is.na(`Med/Surg`)) %>% filter(Date>today()-9) #We get data three days behind
```

Number of reports the week before

```{r}
week_before <- data %>%  filter(!is.na(`Med/Surg`)) %>% filter(Date>today()-17 & Date<today()-9)
```


How often ICU was full

```{r}
goose_eggs_adult <- last_week %>% filter(`Critical Care`=="0") %>% 
  filter(Facility!="Nationwide Children's Hospital (T1-B-P)" &
         Facility!="Dayton Children's (T1-P)" &
         Facility!="Children's Hospital - Liberty Campus"&
         Facility!="Akron Children's Hospital (T2-B-P)"&
         Facility!="University Hospitals Rainbow Babies and Children's Hospital (T1-P)"&
         Facility!="Akron Children's Hospital - Mahoning Valley (P)" &
         Facility!="ProMedica Toledo-Toledo Children's Hospitals (T1-P)"&
         Facility!="Cincinnati Children's Hospital Medical Center (T1-P)"&
           FileName=="ODH Adult Hospital Bed_Availability"|FileName=="ODH Adult Hospital Bed Availability")
  
goose_eggs_week_before <- week_before %>% filter(`Critical Care`=="0") %>% 
  filter(Facility!="Nationwide Children's Hospital (T1-B-P)" &
         Facility!="Dayton Children's (T1-P)" &
         Facility!="Children's Hospital - Liberty Campus"&
         Facility!="Akron Children's Hospital (T2-B-P)"&
         Facility!="University Hospitals Rainbow Babies and Children's Hospital (T1-P)"&
         Facility!="Akron Children's Hospital - Mahoning Valley (P)" &
         Facility!="ProMedica Toledo-Toledo Children's Hospitals (T1-P)"&
         Facility!="Cincinnati Children's Hospital Medical Center (T1-P)"&
           FileName=="ODH Adult Hospital Bed_Availability"|FileName=="ODH Adult Hospital Bed Availability")
```


Beds per day 


```{r}
data <- data %>% 
  mutate(data_type = case_when( 
    FileName == "Central Region Hospital Resources" ~ 0                     
, FileName ==  "Hospital- Adult Bed Availability" ~ 1                     
,FileName == "Hospital- Pediatric Bed Availability"   ~  2              
,FileName == "Northeast Central Region Hospital Resources"    ~    0    
,FileName == "Northeast Region Hospital Resources"~     0               
,FileName == "Northwest Region Hospital Resources"   ~  0               
,FileName == "Southeast & Southeast Central Region Hospital Resources"~0
,FileName == "Southwest Region Hospital Resources"  ~  0                
,FileName == "West Central Region Hospital Resources" ~  0              
,FileName == "Central Region Hospital_Resources" ~  0                   
,FileName == "Northeast Central Region Hospital_Resources"  ~  0       
,FileName == "Northeast Region Hospital_Resources "    ~   0            
,FileName == "Northwest Region Hospital_Resources"~  0                  
,FileName == "ODH Adult Hospital Bed Availability" ~  1                 
,FileName == "ODH Peds Hospital Bed Availability" ~   2                 
,FileName == "Southeast.Southeast Central Region Hospital_Resources" ~ 0
,FileName == "Southwest Region Hospital_Resources"  ~ 0                 
,FileName == "West Central Region Hospital_Resources"~  0               
,FileName == "Northeast Region Hospital_Resources" ~   0                
,FileName == "Southeast Region Hospital_Resources" ~   0                
,FileName == "Southwest Region Hospital_Resources " ~    0              
,FileName == "ODH Adult Hospital Bed_Availability"   ~  1               
,FileName == "ODH Pediatric Hospital Bed_Availability" ~ 2               
,FileName == "ODH Peds Hospital Bed_Availability" ~  2                  
,FileName == "West Central Hospital_Resources" ~  0                     
,FileName == "ODH Adult Hospital Bed_Availability 4.3-4.9" ~ 1          
,FileName == "ODH Peds Hospital Bed_Availability 4.3-4.9" ~  2          
,FileName == "ODH Adults Hospital Bed_Availability" ~  1                
,FileName == "Southeast Region Hospital Resources"  ~ 0                 
,FileName == "Northeast Region Hospital Resources "~0 ))


#Equipment=0, Adult=1, Kid=2
```


Exporting data to look at in Tableau: 

```{r}
rio::export(data, "Hospital capacity and PPE data as of 11-20-2020.csv")
```



If you want to check:
```{r}
adults <-  data %>% filter(data_type==1 | data_type ==2) %>% filter(date(Date)==today()-4) %>% group_by(Facility) %>%  summarize(beds=mean(`Med/Surg`, na.rm=TRUE))
kids <-  data %>% filter(data_type ==2) %>% filter(date(Date)==(today()-3)) %>% group_by(Facility) %>%  summarize(beds=mean(`Med/Surg`, na.rm=TRUE))
```



